# 前端结构设计

> Daniel Mall - Nuxt4 前端架构文档

---

## 一、技术栈

| 技术        | 版本 | 说明         |
| ----------- | ---- | ------------ |
| Nuxt        | 4.x  | SSR 框架     |
| Vue         | 3.x  | 响应式框架   |
| TypeScript  | 5.x  | 类型安全     |
| TailwindCSS | 3.x  | 原子化 CSS   |
| Pinia       | 2.x  | 状态管理     |
| VueUse      | 10.x | 组合式函数库 |

---

## 二、项目结构

```
daniel-web/
├── app/
│   ├── components/           # 组件
│   │   ├── common/          # 通用组件
│   │   │   ├── AppHeader.vue
│   │   │   ├── AppFooter.vue
│   │   │   ├── AppSidebar.vue
│   │   │   └── ThemeSwitch.vue
│   │   ├── tools/           # 工具相关组件
│   │   │   ├── ToolCard.vue
│   │   │   ├── ToolList.vue
│   │   │   ├── ToolExecutor.vue
│   │   │   └── ToolHistory.vue
│   │   └── user/            # 用户相关组件
│   │       ├── LoginModal.vue
│   │       ├── UserAvatar.vue
│   │       └── UserMenu.vue
│   │
│   ├── composables/          # 组合式函数
│   │   ├── useUser.ts       # 用户状态
│   │   ├── useTheme.ts      # 主题管理
│   │   ├── useTools.ts      # 工具相关
│   │   ├── useHistory.ts    # 历史记录
│   │   └── useFavorites.ts  # 收藏功能
│   │
│   ├── layouts/              # 布局
│   │   ├── default.vue      # 默认布局
│   │   └── blank.vue        # 空白布局
│   │
│   ├── pages/                # 页面路由
│   │   ├── index.vue        # 首页
│   │   ├── tools/
│   │   │   ├── index.vue    # 工具列表
│   │   │   └── [id].vue     # 工具详情
│   │   ├── history.vue      # 历史记录
│   │   ├── favorites.vue    # 我的收藏
│   │   └── profile.vue      # 个人中心
│   │
│   ├── plugins/              # 插件
│   │   ├── api.ts           # API 客户端
│   │   └── toast.ts         # 消息提示
│   │
│   └── utils/                # 工具函数
│       ├── format.ts        # 格式化
│       ├── storage.ts       # 本地存储
│       └── validate.ts      # 验证
│
├── assets/                   # 静态资源
│   ├── styles/
│   │   ├── main.scss        # 主样式
│   │   ├── themes/          # 主题样式
│   │   │   ├── light.scss
│   │   │   ├── dark.scss
│   │   │   └── hero.scss
│   │   └── variables.scss   # CSS 变量
│   └── icons/               # 图标
│
├── public/                   # 公共资源
│   ├── favicon.ico
│   └── robots.txt
│
├── server/                   # 服务端
│   └── api/                 # BFF 接口
│
├── stores/                   # Pinia Store
│   ├── user.ts
│   ├── tools.ts
│   └── app.ts
│
├── types/                    # 类型定义
│   ├── api.d.ts
│   ├── tool.d.ts
│   └── user.d.ts
│
├── nuxt.config.ts           # Nuxt 配置
├── tailwind.config.ts       # Tailwind 配置
└── tsconfig.json            # TypeScript 配置
```

---

## 三、路由设计

### 3.1 路由表

| 路由         | 页面            | 说明          |
| ------------ | --------------- | ------------- |
| `/`          | index.vue       | 首页          |
| `/tools`     | tools/index.vue | 工具列表      |
| `/tools/:id` | tools/[id].vue  | 工具详情/执行 |
| `/history`   | history.vue     | 历史记录      |
| `/favorites` | favorites.vue   | 我的收藏      |
| `/profile`   | profile.vue     | 个人中心      |

### 3.2 路由中间件

```typescript
// middleware/auth.ts
export default defineNuxtRouteMiddleware(to => {
  const { user } = useUser()

  // 需要登录的页面
  const authRequired = ['/profile']

  if (authRequired.includes(to.path) && !user.value) {
    return navigateTo('/')
  }
})
```

---

## 四、页面设计

### 4.1 首页（index.vue）

```
┌──────────────────────────────────────────┐
│  Header (Logo, 搜索, 用户)               │
├──────────────────────────────────────────┤
│                                          │
│  Hero Section                            │
│  "客服工具箱，效率提升神器"               │
│                                          │
├──────────────────────────────────────────┤
│  热门工具                                │
│  ┌────────┐ ┌────────┐ ┌────────┐       │
│  │ Tool 1 │ │ Tool 2 │ │ Tool 3 │       │
│  └────────┘ └────────┘ └────────┘       │
├──────────────────────────────────────────┤
│  工具分类                                │
│  [计算类] [模板类] [分析类] [成长]        │
├──────────────────────────────────────────┤
│  Footer                                  │
└──────────────────────────────────────────┘
```

### 4.2 工具列表（tools/index.vue）

```
┌──────────────────────────────────────────┐
│  Header                                  │
├─────────┬────────────────────────────────┤
│         │  筛选栏: [分类] [排序] [搜索]   │
│ Sidebar │────────────────────────────────│
│         │  ┌────────┐ ┌────────┐        │
│ 分类    │  │ Tool   │ │ Tool   │        │
│ 列表    │  └────────┘ └────────┘        │
│         │  ┌────────┐ ┌────────┐        │
│         │  │ Tool   │ │ Tool   │        │
│         │  └────────┘ └────────┘        │
│         │                               │
│         │  分页                          │
└─────────┴────────────────────────────────┘
```

### 4.3 工具详情（tools/[id].vue）

```
┌──────────────────────────────────────────┐
│  Header                                  │
├──────────────────────────────────────────┤
│  面包屑: 首页 > 工具 > KPI计算器          │
├──────────────────────────────────────────┤
│                                          │
│  工具标题        [收藏] [分享]           │
│                                          │
├─────────────────────┬────────────────────┤
│                     │                    │
│   输入区域          │   结果区域         │
│                     │                    │
│   总接待量: [___]   │   解决率: 85%      │
│   解决量:   [___]   │   处理时长: 5.6分  │
│   处理时长: [___]   │                    │
│                     │   [复制] [导出]    │
│   [计算]  [重置]    │                    │
│                     │                    │
├─────────────────────┴────────────────────┤
│  历史记录                                │
│  ┌────────────────────────────────────┐  │
│  │ 2024-01-29 10:00  解决率 85%       │  │
│  │ 2024-01-28 15:30  解决率 82%       │  │
│  └────────────────────────────────────┘  │
└──────────────────────────────────────────┘
```

---

## 五、组件设计

### 5.1 工具卡片（ToolCard.vue）

```vue
<script setup lang="ts">
import type { Tool } from '~/types/tool'

const props = defineProps<{
  tool: Tool
}>()

const emit = defineEmits<{
  (e: 'click'): void
  (e: 'favorite'): void
}>()
</script>

<template>
  <div class="tool-card" @click="emit('click')">
    <div class="tool-card__icon">
      <Icon :name="tool.icon" />
    </div>
    <div class="tool-card__content">
      <h3 class="tool-card__title">{{ tool.name }}</h3>
      <p class="tool-card__desc">{{ tool.description }}</p>
    </div>
    <div class="tool-card__meta">
      <span class="tool-card__usage"> {{ tool.usageCount }} 次使用 </span>
      <button
        class="tool-card__favorite"
        :class="{ 'is-active': tool.isFavorite }"
        @click.stop="emit('favorite')"
      >
        <Icon :name="tool.isFavorite ? 'heart-filled' : 'heart'" />
      </button>
    </div>
  </div>
</template>
```

### 5.2 工具执行器（ToolExecutor.vue）

```vue
<script setup lang="ts">
import type { ToolConfig } from '~/types/tool'

const props = defineProps<{
  toolId: number
  config: ToolConfig
}>()

const input = ref<Record<string, unknown>>({})
const output = ref<Record<string, unknown> | null>(null)
const loading = ref(false)

const execute = async () => {
  loading.value = true
  try {
    const result = await $fetch(`/api/v1/tools/${props.toolId}/execute`, {
      method: 'POST',
      body: { input: input.value },
    })
    output.value = result.data.output
  } finally {
    loading.value = false
  }
}

const reset = () => {
  input.value = {}
  output.value = null
}
</script>

<template>
  <div class="tool-executor">
    <!-- 输入区域 -->
    <div class="tool-executor__input">
      <DynamicForm :fields="config.inputs" v-model="input" />
      <div class="tool-executor__actions">
        <KvButton @click="execute" :loading="loading"> 计算 </KvButton>
        <KvButton variant="secondary" @click="reset"> 重置 </KvButton>
      </div>
    </div>

    <!-- 结果区域 -->
    <div class="tool-executor__output" v-if="output">
      <ResultDisplay :fields="config.outputs" :data="output" />
    </div>
  </div>
</template>
```

---

## 六、状态管理

### 6.1 用户状态（stores/user.ts）

```typescript
export const useUserStore = defineStore('user', () => {
  const user = ref<User | null>(null)
  const anonymousId = ref<string>('')
  const token = ref<string>('')

  const isLoggedIn = computed(() => !!user.value?.email)

  // 初始化匿名用户
  const initAnonymous = async () => {
    let id = localStorage.getItem('dm-anonymous-id')
    if (!id) {
      id = crypto.randomUUID()
      localStorage.setItem('dm-anonymous-id', id)
    }
    anonymousId.value = id

    // 获取或创建用户
    const { data } = await $fetch('/api/v1/auth/anonymous', {
      method: 'POST',
      body: { anonymousId: id },
    })
    user.value = data
  }

  // 绑定邮箱
  const bindEmail = async (email: string, code: string) => {
    const { data } = await $fetch('/api/v1/auth/bind-email', {
      method: 'POST',
      body: { email, code },
    })
    token.value = data.token
    user.value = { ...user.value, email }
  }

  // 登出
  const logout = () => {
    token.value = ''
    user.value = null
  }

  return {
    user,
    anonymousId,
    token,
    isLoggedIn,
    initAnonymous,
    bindEmail,
    logout,
  }
})
```

### 6.2 工具状态（stores/tools.ts）

```typescript
export const useToolsStore = defineStore('tools', () => {
  const tools = ref<Tool[]>([])
  const categories = ref<Category[]>([])
  const currentTool = ref<Tool | null>(null)

  // 获取工具列表
  const fetchTools = async (params?: { category?: string; keyword?: string }) => {
    const { data } = await $fetch('/api/v1/tools', {
      params,
    })
    tools.value = data.content
  }

  // 获取工具详情
  const fetchTool = async (id: number) => {
    const { data } = await $fetch(`/api/v1/tools/${id}`)
    currentTool.value = data
  }

  // 切换收藏
  const toggleFavorite = async (toolId: number) => {
    const tool = tools.value.find(t => t.id === toolId)
    if (!tool) return

    if (tool.isFavorite) {
      await $fetch(`/api/v1/favorites/${toolId}`, { method: 'DELETE' })
    } else {
      await $fetch('/api/v1/favorites', {
        method: 'POST',
        body: { toolId },
      })
    }
    tool.isFavorite = !tool.isFavorite
  }

  return {
    tools,
    categories,
    currentTool,
    fetchTools,
    fetchTool,
    toggleFavorite,
  }
})
```

---

## 七、配置文件

### 7.1 nuxt.config.ts

```typescript
export default defineNuxtConfig({
  devtools: { enabled: true },

  modules: ['@nuxtjs/tailwindcss', '@pinia/nuxt', '@vueuse/nuxt', '@nuxt/icon'],

  css: ['~/assets/styles/main.scss'],

  app: {
    head: {
      title: 'Daniel Mall - 客服工具箱',
      meta: [{ name: 'description', content: '面向电商客服的工具订阅平台' }],
      htmlAttrs: {
        lang: 'zh-CN',
      },
    },
  },

  runtimeConfig: {
    public: {
      apiBase: process.env.API_BASE || 'http://localhost:8080/api/v1',
    },
  },
})
```

### 7.2 tailwind.config.ts

```typescript
export default {
  content: ['./app/**/*.{vue,ts}', './components/**/*.{vue,ts}'],

  theme: {
    extend: {
      colors: {
        dm: {
          primary: 'var(--dm-color-primary)',
          secondary: 'var(--dm-color-secondary)',
          background: 'var(--dm-color-background)',
          surface: 'var(--dm-color-surface)',
          text: 'var(--dm-color-text)',
          'text-secondary': 'var(--dm-color-text-secondary)',
        },
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
    },
  },
}
```
